---
title: "Creating prolfqua Configurations"
author: "Witold Wolski"
date: "14/12/2020"
output: html_document
vignette: >
  %\VignetteIndexEntry{Creating prolfqua Configurations} 
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

# Creating a configuration for a file in long data format.

Given Peptide Quantification Report generated by Spectronaut (a table in long format), we create a Configuration that enables the use of prolfqua.
The configuration object describes the columns in the long table so that prolfqua functions know which columns to use.

```{r}
library(tidyverse)
library(prolfqua)
file <- prolfqua:::.find.package.file("prolfqua","samples/spectronaut_PEPTIDE.xls")

xx <- readr::read_tsv(file)
xx <- xx %>% rename(EG.TotalQuantity = "EG.TotalQuantity (Settings)")
xx$Isotope.Label <- "light"
```

We create a Table annotation object and start annotating the data we read.

```{r}
atable <- AnalysisTableAnnotation$new()
atable$fileName = "R.FileName"
atable$ident_qValue = "EG.Qvalue"
atable$workIntensity = "EG.TotalQuantity"
atable$isotopeLabel = "Isotope.Label"

```

The columns identifying the measured features, which are proteins, peptides or precursors, are the described using the named list hierarchy. The values of the list are the column names, while the names of your list are arbitrary as long as they are valid R column names (see function `make.names`). 

The names list factors, is used to point to the columns containing the factors of you analysis.
Here we rename the column "R.Condition" to "Marker". The data.frame can contain more than one factor. 


```{r}
atable$hierarchy[["PG.ProteinAccessions"]]    <-  "PG.ProteinAccessions"
atable$hierarchy[["EG.PrecursorId"]]    <-  "EG.PrecursorId"
atable$factors[["Marker"]] <- "R.Condition"
```


Lastly, we create an Analysis parameter object, and the Analysis Configuration. The function `setup_analysis`, creates from data frame in long format a data.frame compatible with your configuration. We can now run most of the function in the package using the data and configuration.

```{r}
config <- AnalysisConfiguration$new(atable)
analysis_data <- setup_analysis(xx, config)

prolfqua::summarize_hierarchy(analysis_data, config)

```

