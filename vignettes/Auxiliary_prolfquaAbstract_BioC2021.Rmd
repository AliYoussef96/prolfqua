---
  title: "Auxiliary - Prolfqua - R package for visualization and modelling of proteomics label-free quantification data"
author: "Witold Wolski"
date: "16/11/2020"
output:
  html_document: default
pdf_document:
  keep_tex: yes
vignette: >
  %\VignetteIndexEntry{Auxiliary - Euro Bioconductor 2020}
%\VignetteEncoding{UTF-8}
%\VignetteEngine{knitr::rmarkdown}
---



  The R-package for **pro**teomics **l**abel **f**ree **qua**ntification `prolfqua` (read: prolewka) evolved from functions and code snippets used to visualize and analyze label-free quantification data. To compute protein fold changes among treatment conditions, we first used t-test, linear models or functions implemented in the package limma. We evaluated [MSStats]( 10.18129/B9.bioc.MSstats), [ROPECA](10.1038/s41598-017-05949-y) or [MSqRob](https://github.com/statOmics/MSqRob) all implemented in R, with the idea to integrate the various approaches in our analysis pipeline. Although all these packages are written in R, model specification, input, and output formats differ widely and wildly. Therefore, but also to have a better understanding of the inferences we produce, we decided to use the R linear and mixed effect models directly and to reimplement some features of the the other when considered useful or possible. The R-package prolfqua is the outcome of this venture.

When developing _prolfqua_, we draw inspiration from packages such as _sf_, which uses data in a long tidy table format. In _prolfqua_, the data needed for analysis is represented using a single data-frame in long format and an _R6_ configuration object. The configuration annotates the data-frame, i.e., specifies what information can be found in which data.frame column. This makes integrating new data if provided in long formatted tables simple. All that is needed to incorporate Spectronaut, Skyline text output, or __MSStats__ inputs is to update the configuration object. For software like MaxQuant writing the data in a wide table format, with several intensity columns, one for each sample, we implemented methods that transform the data into a long format. Relying on the long tidy data table format enabled us to easily access various useful data manipulation and visualization methods implemented in the R packages _dplyr_ and _ggplot2_.

 R linear model and linear mixed effect models allow to model parallel designs, repeated measurements, factorial designs, and many more.  These models can be fitted to proteomics quantification data. R's formula interface for linear models is flexible, widely used, and well documented. We integrate R's linear model and mixed model formula interface in prolfqua's API. Therefore, knowledge of the R regression model infrastructure is of advantage when using our package. Acknowledging the formula interface's complexity, and the popularity of MSstats, we provided functionality to derive the model formula from an MSstats data format.
 
prolfqua fits the linear model to all the proteins in the dataset. Afterwards to test hypothesis contrasts can be computed, but also ANOVA analysis or model selection using the likelihood ratio test can be performed for  for thousand of proteins. Making use of the parallel structure of the analysis _prolfqua_ implements t-statistic moderations [limma]. It also computes probabilities of differential protein regulation based on peptide level models [ropeca]. 

_prolfqua_ integrates most of the steps of the LFQ data analysis workflow, starting with, quality control, data normalization, protein aggregation, sample size estimation, modelling and hypothesis testing. For instance, the quality control module makes it easy to determine the coefficients of variations (CV) for peptide and proteins, within conditions, summarize and visualize missignes, visualize intensities. To infer protein intensities from peptide measurements the top 3, Tukeys median polish or robust linear regression can be used.

To optimize an data analysis workflow, e.g. to compare quantification software e.g. MaxQuant, prolfqua implemnts and integerates methods for benchmarking, e.g, computing ROC curves. These methods were developed when we were assessing the differences between: linear models, mixed effect models, p-value moderation, or Bayesian regression models using the IonStar dataset.

We grouped the functions into classes (e.g. Plotter, Summarizer, Stats, Model etc) using R6 because R6 enjoys good supprot such as code completion and visual debugging in RStudio. The package hopefully makes it easy to perform proteomics quantitative data analysis, to generate visualizations and to integrate them into reports using Rmarkdown. The package can be installed from [www.github.com/wolski/prolfqua](www.github.com/wolski/prolfqua) and we are working on making it available through bioconductor.
