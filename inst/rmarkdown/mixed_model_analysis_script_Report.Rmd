---
title: "LFQ modelling results"
author: "FGCZ"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    includes:
      in_header: fgcz_header.html
      after_body: fgcz_footer.html
params:
  pars: NULL
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(flextable)
pars <- params$pars
```


- project Id : `r pars$project_Id`
- order Id : `r pars$order_Id`
- parent work-unit Id : `r pars$workunit_Id`
- input file : `r pars$inputMQfile`
- modelling implemented by : `r pars$author`


# Sample QC

The raw files are annotated with the following factors and factor levels:

```{r annotation}
ftab <- flextable(pars$annotation) %>%
  autofit() %>% set_caption("Sample annotations.")
ftab

```

- [Peptide intensity vs RT plot](qc_results/retention_time_plot.png){target="_blank"} 
- [PCA plot](qc_results/protein_intensities_PCA_.pdf){target="_blank"} showing the samples according to the first and second principal component.
- [Heatmap based on sample correlation](qc_results/protein_intensities_heatmap_correlation_.pdf){target="_blank"}.
- [Protein Intensity heatmap](qc_results/protein_intensities_heatmap_.pdf){target="_blank"}.
- The protein intensities in [excel xlsx format](qc_results/protein_intensities_wide_.xlsx){target="_blank"}.
- A [pdf file](qc_results/protein_intensities_inference_figures.pdf){target="_blank"} containing all the peptide and protein intensities. 
- A quality control report of estimated protein intensities [html](qc_results/protein_intensities_qc.html){target="_blank"}.


# Mixed Effects Model

The following mixed effects model was fitted: 

__`r format(formula(pars$model))`__

Using this model the following contrasts were computed.


```{r contrasts}
Contrasts <- data.frame(contrast = names(pars$Contrasts), explicit = pars$Contrasts)
ft_contrast <- flextable(Contrasts)
ft_contrast <- ft_contrast %>% set_caption("Contrasts (vs - versus, gv - given).")
ft_contrast

```

```{r filepaths, include=FALSE}
anovaXLSX <- file.path(pars$modelling_dir, "Anova_Model")
anovaPDF <- file.path(pars$modelling_dir, "Anova_p.values_Model.pdf")
contrastXLSX <- file.path(pars$modelling_dir, "foldchange_estimates")
histogramPVal <-   file.path(pars$modelling_dir, "Contrasts_Histogram_p.value_Model")
histogramPValAdj <- file.path(pars$modelling_dir, "Contrasts_Histogram_p.value.adjusted_Model")
volcanoPVal <- file.path(pars$modelling_dir, "Contrasts_Volcano_p.value_Model")
volcanoPValAdj <- file.path(pars$modelling_dir, "Contrasts_Volcano_p.value.adjusted_Model")
maPlot <- file.path(pars$modelling_dir, "Contrasts_MA_FC_estimate_Model")
```


- ANOVA results ([excel xlsx format](`r paste0(anovaXLSX,".xlsx")`);[html](`r paste0(anovaXLSX,".html")`){target="_blank"} and histogram of p-Values [pdf](`r anovaPDF`){target="_blank"} which shows which factors are most significant.

- For all contrasts and proteins:
    - A __table__ with all fold change estimates and p-Values ([excel xlsx format](`r paste0(contrastXLSX,".xlsx")`); [html](`r paste0(contrastXLSX,".html")`){target="_blank"}) with p-Values for all proteins and contrasts. For proteins not quantified in one of the conditions, _pseudo_ estimates are provided.
    - __Histogram of p-Values__ ([pdf](`r paste0(histogramPVal,".pdf")`){target="_blank"}) shows the distribution of the p-Values for each contrast to see which contrast produced the largest number of significant changes
    - __Histogram of adjusted p-Values__ ([pdf](`r paste0(histogramPValAdj,".pdf")`){target="_blank"}) shows the distribution of the p-Values after multiplicity adjustment for each contrast to see which contrast produced the largest number of significant changes.
    - __Volcano plot of p-Values vs fold change estimate__ ([pdf](`r  paste0(volcanoPVal,".pdf")`){target="_blank"}; [html](`r paste0(volcanoPVal,".html")`){target="_blank"}) which on the vertical axis shows the protein p-Values versus the the log2 fold changes on the horizontal axis.
    - __Volcano plot of adjusted p-Values vs fold change estimate__ ([pdf](`r paste0(volcanoPValAdj,".pdf")`){target="_blank"}; [html](`r paste0(volcanoPValAdj, ".html")`){target="_blank"})  which on the vertical axis shows the adjusted protein _p-Values_ versus the the _log2_ fold changes on the horizontal axis.
    - [__MA plot__](https://en.wikipedia.org/wiki/MA_plot) ([pdf](`r paste0(maPlot,".pdf")`){target="_blank"}; [html](`r paste0(maPlot, ".html")`){target="_blank"}). The vertical axis shows the contrast estimate (_log2 FC_) while the horizontal axis shows the mean of the measurments.
    


